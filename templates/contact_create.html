{% extends "base.html" %}

{% block content %}
<h2>Create Contact</h2>
<form id="contact-form">
    <div class="mb-3">
        <label class="form-label">First Name</label>
        <input type="text" class="form-control" id="first_name" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Last Name</label>
        <input type="text" class="form-control" id="last_name" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Email</label>
        <input type="email" class="form-control" id="email" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Phone</label>
        <input type="text" class="form-control" id="phone" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Organization</label>
        <select class="form-select" id="organization" required>
            <option value="">Select</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Create</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const res = await ApiClient.request('/organizations/');
        if (res && res.ok) {
            const orgs = await res.json();
            const select = document.getElementById('organization');
            orgs.forEach(org => {
                const option = document.createElement('option');
                option.value = org.id;
                option.textContent = org.name;
                select.appendChild(option);
            });
        }
    });

    document.getElementById('contact-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
            first_name: document.getElementById('first_name').value,
            last_name: document.getElementById('last_name').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            organization: document.getElementById('organization').value
        };

        const res = await ApiClient.request('/contacts/', 'POST', data);
        if (res && res.ok) {
            showAlert('Contact created!');
            document.getElementById('contact-form').reset();
        } else {
            showAlert('Failed to create', 'danger');
        }
    });
</script>
{% endblock %}